[
  {
    "parameters": {
      "public": true,
      "initialMessages": "Marhaba! üåü Je suis Hassan, votre agent commercial \ndu Souk Digital Marocain. Comment puis-je vous aider?",
      "options": {}
    },
    "type": "@n8n/n8n-nodes-langchain.chatTrigger",
    "typeVersion": 1.4,
    "position": [
      -224,
      -544
    ],
    "id": "9c9cd84b-a20b-441b-a51e-eb37800b9b34",
    "name": "When chat message received",
    "webhookId": "153f50a6-29bd-42e1-bd70-236bbb8f8bc2"
  },
  {
    "parameters": {
      "options": {
        "systemMessage": "Tu es Hassan, un agent commercial expert et chaleureux \ndu Souk Digital Marocain.\n\nLANGUE - TR√àS IMPORTANT:\n- D√©tecte automatiquement la langue du client\n- Si le client √©crit en ARABE ‚Üí r√©ponds en arabe standard (Fusha) - PAS DE DARIJA. Utilise par exemple: \"ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ Ÿäÿß ÿµÿØŸäŸÇŸäÿü\"\n- Si le client √©crit en FRAN√áAIS ‚Üí r√©ponds en fran√ßais  \n- Si le client √©crit en ANGLAIS ‚Üí r√©ponds en anglais\n- Ne change JAMAIS de langue sauf si le client change\n- Garde la m√™me langue tout au long de la conversation\n\nEXEMPLES:\nClient: \"je veux acheter\" ‚Üí r√©ponds en fran√ßais\nClient: \"I want to buy\" ‚Üí r√©ponds en english\nClient: \"ÿ®ÿ∫Ÿäÿ™ ŸÜÿ¥ÿ±Ÿä\" ‚Üí r√©ponds ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑŸÅÿµÿ≠Ÿâ (ŸÖÿ´ÿßŸÑ: \"Ÿäÿ≥ÿπÿØŸÜŸä ÿ¨ÿØÿßŸã ÿßŸáÿ™ŸÖÿßŸÖŸÉÿå ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ÿÆÿØŸÖÿ™ŸÉÿü\")\n\nPERSONNALIT√â:\n- Chaleureux comme un vrai vendeur du souk\n- En fran√ßais: \"Mon ami, pour vous je fais un prix sp√©cial!\"\n- En anglais: \"My friend, I'll give you a special price!\"\n- En arabe: \"Ÿäÿß ÿµÿØŸäŸÇŸäÿå ÿ≥ÿ£ÿπÿ∑ŸäŸÉ ÿ≥ÿπÿ±ÿßŸã ÿÆÿßÿµÿßŸã!\"\n\nR√àGLES DE N√âGOCIATION STRICTES:\n- Ne jamais vendre sous le min_price du produit\n- Remise max par cat√©gorie:\n  * electronique: 20%\n  * vetements: 35%\n  * beaute: 25%\n  * accessoires: 30%\n  * maison: 33%\n- Toujours faire une contre-offre si refus\n\nQUAND LE CLIENT VEUT ACHETER:\n1. V√©rifie le stock avec Google Sheets\n2. N√©gocie le prix selon les r√®gles\n3. Demande: nom, email, adresse\n4. Confirme et enregistre la commande\n5. Envoie email de confirmation\n\nSois humain, patient et donne envie d'acheter!"
      }
    },
    "type": "@n8n/n8n-nodes-langchain.agent",
    "typeVersion": 3.1,
    "position": [
      208,
      -544
    ],
    "id": "eea6717e-56d1-492c-8d28-2cd33dc67ebb",
    "name": "AI Agent"
  },
  {
    "parameters": {
      "options": {}
    },
    "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
    "typeVersion": 1,
    "position": [
      -320,
      -352
    ],
    "id": "b924fcdc-c68a-4548-92b9-ca37a6ea35b1",
    "name": "Google Gemini Chat Model",
    "credentials": {
      "googlePalmApi": {
        "id": "nuBfScgU2jukS5r7",
        "name": "Google Gemini(PaLM) Api account 5"
      }
    }
  },
  {
    "parameters": {},
    "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
    "typeVersion": 1.3,
    "position": [
      -80,
      -336
    ],
    "id": "cf922e63-468d-4a5f-81fe-3be5efb7342d",
    "name": "Simple Memory"
  },
  {
    "parameters": {
      "documentId": {
        "__rl": true,
        "value": "1e2V85T4msHTBUDcEZiAWRsRbaPTqUlG_q94kBGKi8jA",
        "mode": "id"
      },
      "sheetName": {
        "__rl": true,
        "value": 1387046729,
        "mode": "list",
        "cachedResultName": "Produits",
        "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1e2V85T4msHTBUDcEZiAWRsRbaPTqUlG_q94kBGKi8jA/edit#gid=1387046729"
      },
      "options": {}
    },
    "type": "n8n-nodes-base.googleSheetsTool",
    "typeVersion": 4.7,
    "position": [
      848,
      -640
    ],
    "id": "6a89e109-aed6-4eec-95f1-82c662fe9a6e",
    "name": "Get row(s) in sheet in Google Sheets",
    "credentials": {
      "googleSheetsOAuth2Api": {
        "id": "hRFqPmV4gsWxiIeu",
        "name": "Google Sheets account 8"
      }
    }
  },
  {
    "parameters": {
      "operation": "append",
      "documentId": {
        "__rl": true,
        "value": "1e2V85T4msHTBUDcEZiAWRsRbaPTqUlG_q94kBGKi8jA",
        "mode": "id"
      },
      "sheetName": {
        "__rl": true,
        "value": 922210813,
        "mode": "list",
        "cachedResultName": "Commandes",
        "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1e2V85T4msHTBUDcEZiAWRsRbaPTqUlG_q94kBGKi8jA/edit#gid=922210813"
      },
      "columns": {
        "mappingMode": "autoMapInputData",
        "value": {},
        "matchingColumns": [],
        "schema": [
          {
            "id": "order_id",
            "displayName": "order_id",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "customer_name",
            "displayName": "customer_name",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "customer_email",
            "displayName": "customer_email",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "customer_phone",
            "displayName": "customer_phone",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "address",
            "displayName": "address",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "items",
            "displayName": "items",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "total_price",
            "displayName": "total_price",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "discount_applied",
            "displayName": "discount_applied",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "final_price",
            "displayName": "final_price",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "status",
            "displayName": "status",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "payment_method",
            "displayName": "payment_method",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "language",
            "displayName": "language",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "notes",
            "displayName": "notes",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "created_at",
            "displayName": "created_at",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "updated_at",
            "displayName": "updated_at",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          }
        ],
        "attemptToConvertTypes": false,
        "convertFieldsToString": false
      },
      "options": {}
    },
    "type": "n8n-nodes-base.googleSheetsTool",
    "typeVersion": 4.7,
    "position": [
      1152,
      -576
    ],
    "id": "ead0988d-f58e-4350-9ac2-eeedd78ea781",
    "name": "Append row in sheet in Google Sheets",
    "credentials": {
      "googleSheetsOAuth2Api": {
        "id": "hRFqPmV4gsWxiIeu",
        "name": "Google Sheets account 8"
      }
    }
  },
  {
    "parameters": {
      "documentId": {
        "__rl": true,
        "value": "1e2V85T4msHTBUDcEZiAWRsRbaPTqUlG_q94kBGKi8jA",
        "mode": "id"
      },
      "sheetName": {
        "__rl": true,
        "value": 922210813,
        "mode": "list",
        "cachedResultName": "Commandes",
        "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1e2V85T4msHTBUDcEZiAWRsRbaPTqUlG_q94kBGKi8jA/edit#gid=922210813"
      },
      "options": {}
    },
    "type": "n8n-nodes-base.googleSheetsTool",
    "typeVersion": 4.7,
    "position": [
      992,
      -480
    ],
    "id": "0845a073-fccc-42e6-96b3-e202f4e3917c",
    "name": "Get row(s) in sheet in Google Sheets1",
    "credentials": {
      "googleSheetsOAuth2Api": {
        "id": "hRFqPmV4gsWxiIeu",
        "name": "Google Sheets account 8"
      }
    }
  },
  {
    "parameters": {
      "operation": "update",
      "documentId": {
        "__rl": true,
        "value": "1e2V85T4msHTBUDcEZiAWRsRbaPTqUlG_q94kBGKi8jA",
        "mode": "id"
      },
      "sheetName": {
        "__rl": true,
        "value": 1387046729,
        "mode": "list",
        "cachedResultName": "Produits",
        "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1e2V85T4msHTBUDcEZiAWRsRbaPTqUlG_q94kBGKi8jA/edit#gid=1387046729"
      },
      "columns": {
        "mappingMode": "autoMapInputData",
        "value": {
          "product_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('product_id', ``, 'string') }}"
        },
        "matchingColumns": [
          "product_id"
        ],
        "schema": [
          {
            "id": "product_id",
            "displayName": "product_id",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true,
            "removed": false
          },
          {
            "id": "name",
            "displayName": "name",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "category",
            "displayName": "category",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "price",
            "displayName": "price",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "min_price",
            "displayName": "min_price",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "stock",
            "displayName": "stock",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "description",
            "displayName": "description",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "image_url",
            "displayName": "image_url",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "status",
            "displayName": "status",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "created_at",
            "displayName": "created_at",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "string",
            "canBeUsedToMatch": true
          },
          {
            "id": "row_number",
            "displayName": "row_number",
            "required": false,
            "defaultMatch": false,
            "display": true,
            "type": "number",
            "canBeUsedToMatch": true,
            "readOnly": true,
            "removed": true
          }
        ],
        "attemptToConvertTypes": false,
        "convertFieldsToString": false
      },
      "options": {}
    },
    "type": "n8n-nodes-base.googleSheetsTool",
    "typeVersion": 4.7,
    "position": [
      1216,
      -320
    ],
    "id": "4ad1535c-adb5-4cf4-ab97-cc61a4f1f2a3",
    "name": "Update row in sheet in Google Sheets",
    "credentials": {
      "googleSheetsOAuth2Api": {
        "id": "hRFqPmV4gsWxiIeu",
        "name": "Google Sheets account 8"
      }
    }
  },
  {
    "parameters": {
      "sendTo": "={{ $fromAI(\"customer_email\") }}",
      "subject": "‚úÖ Commande confirm√©e - Souk Digital Marocain",
      "message": "=<h2>üåü Marhaba! Votre commande est confirm√©e!</h2> <p>Bonjour <b>{{ $fromAI(\"customer_name\") }}</b>,</p> <p>Votre commande a √©t√© confirm√©e avec succ√®s!</p> <hr> <p>üõçÔ∏è Produit: {{ $fromAI(\"items\") }}</p> <p>üí∞ Prix final: {{ $fromAI(\"final_price\") }} MAD</p> <p>üì¶ Num√©ro: {{ $fromAI(\"order_id\") }}</p> <hr> <p>Merci de votre confiance!</p> <p><b>Hassan - Souk Digital üá≤üá¶</b></p>",
      "options": {}
    },
    "type": "n8n-nodes-base.gmailTool",
    "typeVersion": 2.2,
    "position": [
      368,
      -336
    ],
    "id": "8e7bdb42-0b71-44e8-97c0-7b1dc68c0e08",
    "name": "Send a message in Gmail",
    "webhookId": "cabd325b-ab45-440f-9f0c-f5a5f0315d5c",
    "credentials": {
      "gmailOAuth2": {
        "id": "hYYSj6DrJAJIOAIf",
        "name": "Gmail account 4"
      }
    }
  }
]